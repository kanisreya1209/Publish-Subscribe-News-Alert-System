<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>News Alert System</title>

  <!-- Bootstrap -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />

  <style>
    body {
      background: #f4f7fb;
    }

    .card {
      border-radius: 16px;
      box-shadow: 0 8px 25px rgba(0,0,0,.08);
    }

    .header {
      text-align: center;
      padding: 25px;
      font-size: 26px;
      font-weight: bold;
      color: #0a2540;
    }

    .badge-topic {
      padding: 6px 10px;
      border-radius: 10px;
      font-size: 12px;
    }

    .notif {
      background: white;
      border-radius: 10px;
      padding: 10px;
      margin-bottom: 8px;
      border-left: 6px solid #0d6efd;
      animation: fadeIn .5s ease;
    }

    @keyframes fadeIn {
      from {opacity: 0; transform: translateY(5px);}
      to {opacity: 1; transform: translateY(0);}
    }
  </style>
</head>

<body>

<div class="container py-4">

  <div class="header">
    ðŸ“¢ Publishâ€“Subscribe News Alert System
  </div>

  <div class="row g-4">

    <!-- SUBSCRIBE -->
    <div class="col-md-6">
      <div class="card p-3">
        <h5>Subscribe to News Topics</h5>
        <div class="row mt-3">
          <div class="col-5">
            <select id="user" class="form-select">
              <option value="Alice">Alice</option>
              <option value="Bob">Bob</option>
              <option value="Charlie">Charlie</option>
            </select>
          </div>

          <div class="col-5">
            <select id="category" class="form-select">
              <option value="sports">Sports</option>
              <option value="technology">Technology</option>
              <option value="politics">Politics</option>
            </select>
          </div>

          <div class="col-2">
            <button class="btn btn-primary w-100" onclick="subscribe()">âœ“</button>
          </div>
        </div>

        <div id="subStatus" class="text-success mt-2"></div>
      </div>
    </div>

    <!-- PUBLISH -->
    <div class="col-md-6">
      <div class="card p-3">
        <h5>Publish News</h5>

        <div class="row mt-3">

          <div class="col-4">
            <select id="pubCategory" class="form-select">
              <option value="sports">Sports</option>
              <option value="technology">Technology</option>
              <option value="politics">Politics</option>
            </select>
          </div>

          <div class="col-6">
            <input id="message" class="form-control" placeholder="Type news..." />
          </div>

          <div class="col-2">
            <button class="btn btn-success w-100" onclick="publish()">ðŸš€</button>
          </div>

        </div>

        <div id="pubStatus" class="text-primary mt-2"></div>
      </div>
    </div>
  </div>

  <!-- NOTIFICATIONS -->
  <div class="card p-3 mt-4">
    <h5>Notifications for <span id="currentUser">Alice</span></h5>
    <div id="feed" class="mt-2"></div>
  </div>

</div>

<script>
const API = "http://localhost:8080";

user.addEventListener("change", () => {
  document.getElementById("currentUser").innerText = user.value;
});

function subscribe() {
  fetch(`${API}/subscribe`, {
    method: "POST",
    body: `user=${user.value}&category=${category.value}`
  })
  .then(() => {
    subStatus.innerText = `Subscribed to ${category.value}!`;
    setTimeout(() => subStatus.innerText = "", 1500);
  });
}

function publish() {
  fetch(`${API}/publish`, {
    method: "POST",
    body: `category=${pubCategory.value}&message=${message.value}`
  })
  .then(() => {
    pubStatus.innerText = "News published!";
    message.value = "";
    setTimeout(() => pubStatus.innerText = "", 1500);
  });
}

setInterval(() => {
  fetch(`${API}/notifications?user=${user.value}`)
    .then(r => r.json())
    .then(data => {
      data.forEach(msg => {
        feed.innerHTML =
          `<div class='notif'>
              <span class='badge bg-primary badge-topic'>New</span>
              &nbsp; ${msg}
           </div>` + feed.innerHTML;
      });
    });
}, 2000);
</script>

</body>
</html>
